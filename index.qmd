---
title: "Geographies of Native Plant Restoration"
author: John Mernitz
subtitle: Planting Selection Tool
date: today
date-format: long
format:
  html:
    dark-mode: true
    theme: 
      light: minty
      dark: minty
    code-fold: true
    toc: true
editor_options: 
  chunk_output_type: console
---

# Introduction

Welcome to the Plant Selection tool! If you would like to know more about this tool and its functionality, please check the about and code steps on the navbar above!

Again, this plant selector is not fully tested, plants should be carefully considered if they are appropriate for one's needs. This page seeks to diversify thoughts and choices about native plants in gardens; do not blindly choose one. Please be aware some of these plants have natural defenses like thorns, irritating sap, or inedible fruits!

Suggestions are organized by species, common name, wetland status, growth type, and duration.

## Libraries

```{r, message=F, warning=F, results=F}
library(tidyverse)
library(leaflet)
library(kableExtra)
library(htmlwidgets)
library(widgetframe)
install.packages("DT")
library(DT)
library(sf)
library(mapview)
library(leafem)
library(terra)
knitr::opts_chunk$set(widgetframe_widgets_dir = 'widgets' ) 
knitr::opts_chunk$set(cache=FALSE)  # cached results off
```

# Plant Selector

**Please use the search bars in any column to filter your data!**

```{r}
native_plants <- read.csv("data/common_plants.csv")

#Here we'll edit the columns so not as much data needs to be loaded

native2 <- native_plants[,c("Scientific_Name", "Common_Name", "CoC", "nwpl_ncne", "Growth_Habit", "Duration")]

#Now we have fewer columns, let's edit the column names so it's more clear what each refers to

datatable(
  native2,
  colnames = c('Scientific Name' = 2, 'Common Name' = 3,'Difficulty' = 4, 'Wetland Status' = 5, 'Growth Type' = 6), 
  filter = 'top',
  options = list(pagelength=5)
  )
```

**Take note of the Wetland Codes below!**

![Figure curtesy of USACE, Wetland Status is used for water tolerance in this selector.](data/Wetland_codes.png)



# Map Selector

This section will allow users to view local wetlands and water features!

```{r}
ditches <- read_sf("https://drive.usercontent.google.com/u/0/uc?id=1SLCufnLDpR4bEJeUB1usJ2OFzBlWXtEY&export=download")
town_bound <- read_sf("https://drive.usercontent.google.com/u/0/uc?id=1WScoYQWLa9_jaobUhm-0xcf1MtTaqoE6&export=download")
state_wetld <- read_sf("https://drive.usercontent.google.com/u/0/uc?id=1uS0oYTaWLGhwGyYHnhkBxn8RZRlwNFkk&export=download")
#Wetland makes up 20.2228% of area of Amherst NY
soils_C <- read_sf("https://drive.usercontent.google.com/u/0/uc?id=1zItxfisuLYZP6ZhnyUzMGH80UShGLAUQ&export=download")
nysnh_cl <- read_sf("https://drive.usercontent.google.com/u/0/uc?id=1Mjfgt23T8KmxcY5OzBJ0DZ4dgW2jnoHd&export=download")
hydro_cl <- read_sf("https://drive.usercontent.google.com/u/0/uc?id=13OIxXMGIlrMYLmIUJuhU8ElM9Dpkoz11&export=download")
wetldsum <- rast("data/WtldSumVal1_8.tif")

#Download.file()
#Save to tempdata folder

town_bound <- st_transform(town_bound, crs = 4326)
state_wetld <- st_transform(state_wetld, crs = 4326)
soils_C <- st_transform(soils_C, crs = 4326)
ditches <- st_transform(ditches, crs = 4326)
nysnh_cl <- st_transform(nysnh_cl, crs = 4326)
hydro_cl <- st_transform(hydro_cl, crs = 4326)
wetldsum <- project(wetldsum, "EPSG:4326")

soil_names <- (unique(soils_C$SOIL_NAME))
wetldsumpal <- colorNumeric(palette = "viridis", domain = values(wetldsum), na.color = "transparent")
soils_pal <- colorFactor(palette = "turbo", domain = soil_names, na.color = "transparent")
```

```{r, fig.width=6, fig.heigt=3, fig.cap="Map of Wetland Files"}
m <- leaflet(town_bound) %>%
  addTiles() %>% # Add a default base layer
  addPolygons(data = town_bound, group = "Amherst Boundary", stroke = TRUE, color = "black", fill = FALSE, weight = 3) %>%
  addPolygons(data = state_wetld, group = "State Wetland", color = "gray", weight = 1, fillOpacity = 0.5, fillColor = "green") %>%
  addPolygons(data = soils_C, group = "Soil Types", color = "gray", weight = 1, fillOpacity = 0.5, fillColor = ~soils_pal(SOIL_NAME), label = ~SOIL_NAME,
    highlightOptions = highlightOptions(weight = 3, color = "white", bringToFront = FALSE)) %>%
  addPolygons(data = nysnh_cl, group = "Significant Wetland", color = "gray", weight = 1, fillOpacity = 0.5, fillColor = "yellow") %>%
  addPolygons(data = hydro_cl, group = "Hydrology", color = "gray", weight = 1, fillOpacity = 0.5, fillColor = "blue") %>%
  addPolygons(data = ditches, group = "Ditches", color = "gray", weight = 1, fillOpacity = 0.5, fillColor = "red") %>%
#  addHomeButton(
#    ext = town_bound,
#    group = "Home",
#    position = "bottomright"
#  ) %>%
  addRasterImage(wetldsum, group = "Wetland Proximity Values", colors = wetldsumpal, opacity = 0.8) %>%
  #addImageQuery(wetldsum, project = TRUE, layerId = "Wetldsum", position = "top") %>%
  addLegend(pal = wetldsumpal, values = values(wetldsum), title = "Wetland Proximity values", opacity = 1) %>%
  #addLegend(pal = soils_pal, values = soils_C$SOIL_NAME, title = "Soil Types", position = "bottomright", opacity = 1)
  #addImageQuery(wetldsum, type = "mousemove", digits = 2) %>%
  addLayersControl(
    baseGroups = c("OSM (default)"),
    overlayGroups = c("Amherst Boundary", "State Wetland", "Soil Types", "Significant Wetland", "Hydrology", "Ditches", "Wetland Proximity Values"),
    options = layersControlOptions(collapsed = FALSE)
  )

m

```
